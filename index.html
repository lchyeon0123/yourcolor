<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="naver-site-verification" content="9eaaced32c0c4e05a25a026700bde547bcb51c4e" />
    <link href="https://fonts.googleapis.com/css?family=Jua&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <title>너의 퍼스널 컬러는</title>
    <meta name="title" content="너의 퍼스널 컬러는">
    <meta name="subject" content="얼굴로 보는 인공지능 퍼스널 컬러 테스트, 나에 어울리는 퍼스널 컬러를 찾아보세요!">
    <meta name="keywords" content="퍼스널,퍼스널컬러,퍼스널 컬러,컬러,진단,컬러진단,컬러 진단, AI, color, colour, personal color,봄톤,웜톤,봄 웜톤,여름톤,쿨톤,여름 쿨톤,가을,가을 웜톤,겨울,겨울 웜톤,인공지능,딥러닝,피부,코디">
    <meta name="author" content="Robotics">
    <meta name="description" content="나는 웜톤일까? 쿨톤일까? AI로 진단하는 나만의 퍼스널 컬러! 퍼스널 컬러를 진단받고 어울리는 컬러,화장품,패션을 추천받으세요">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="canonical" href="https://yourcolor.kr/" />
    <meta property="og:url" content="https://yourcolor.kr/" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="너의 퍼스널 컬러는" />
    <meta property="og:description" content="나는 웜톤일까? 쿨톤일까? AI로 진단하는 나만의 퍼스널 컬러! 퍼스널 컬러를 진단받고 어울리는 컬러,화장품,패션을 추천받으세요"
    />
    <meta property="og:image" content="https://raw.githubusercontent.com/ika9810/Beef-NFT/main/img/beef-icon/beef_thumbnail_kakao.png" />
    <link rel="shortcut icon" href="./img/meat.ico" type="image/x-icon">
    <link rel="icon" href="./img/meat.ico" type="image/x-icon">

    <!-- Go to www.addthis.com/dashboard to customize your tools -->
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-61e2f8f2e956ed9f"></script>
</head>

<body>
    <!-- <script src="script.js" defer></script> -->
    <nav class="p-3 container navbar navbar-expand-lg navbar-light">
        <a class="navbar-brand" href="#" onclick="window.location.reload();">너의 퍼스널 컬러는</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="https://github.com/lchyeon0123/yourcolor">프로젝트 Github 링크
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" id="yotube-top-link" href="https://github.com/ika9810">개발자 Github 프로필</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" id="yotube-top-link" href="https://jongheon-projects.notion.site/YOUR-COLOR-1e09cd74e1d542c1a6cbb65a7a170bcc">프로젝트 Notion 링크</a>
                </li>
            </ul>
            
        </div>
    </nav>
    <section class="section">
        <h1 class="title" onclick="test2();">너의 퍼스널 컬러는</h1>
        <h4 class="subtitle">나는 웜톤일까? 쿨톤일까?</h4>
        <h2 class="subtitle">인공지능이 당신의 얼굴 사진을 분석하여 퍼스널 컬러를 진단합니다!</h2>
    </section>
    <section class="youtube pb-3" id="yotube-mid-link">
        <div class="container mt-3 youtube-cover d-flex flex-row-reverse align-items-center">
            <img src="img/github.png" alt="youtube-icon" class="youtube-icon">
            <a href="https://github.com/lchyeon0123/yourcolor" class="youtube-link">By 로보틱스 총무 듀오 이종헌, 이채현 </a>
        </div>
    </section>
    <!-- sr-only class로 남자 여자를 선택하는 토글을 우선적으로 안보이게 설정하였다. 추후 소고기 이외의 돼지고기등이 추가가 되면 sr-only 클래스를 삭제하면 다시 나타나게 된다. -->
    <h3 class="sr-only pb-2 d-flex justify-content-center">성별을 선택하세요</h3>
    <section class="sr-only d-flex justify-content-center">
        <p class="d-flex align-items-center pr-3">여자</p>
        <div>
            <input type="checkbox" id="gender">
            <label for="gender">
                <span class="knob">
                    <i></i>
                </span>
            </label>
        </div>
        <p class="d-flex align-items-center pl-3">남자</p>
    </section>
    <script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <!-- axios cdn으로 삽입 && 부트스트랩 body 태그 안에 삽임 -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <div class="mt-3 container file-upload" id="main-container">
        <div class="image-upload-wrap">
            <input class="file-upload-input" type='file' onchange="readURL(this);" accept="image/*" />
            <div class="drag-text">
                <img src="img/upload.svg" class="mt-5 pt-5 upload">
                <h3 class="mb-5 pb-5 pt-4  upload-text">당신의 얼굴 사진을 올려놓거나 눌러서 업로드하세요!</h3>
            </div>
        </div>
        <div class="file-upload-content">
            <img class="file-upload-image" id="face-image" src="#" alt="your image" />
            <div id="loading" class="animated bounce">
                <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <p class="text-center">AI가 당신의 퍼스널 컬러를 분석중입니다.</p>
            </div>
            <p class="result-message"></p>
            <div id="label-container" class="d-flex flex-column justify-content-around"></div>
        
            <div class="addthis_inline_share_toolbox"></div>

            <div class="pt-3 image-title-wrap">
                <button type="button p-2" class="try-again-btn" onclick="window.location.reload();">
                    <span class="try-again-text">다른 사진으로 재시도</span>
                </button>
            </div>       
        </div>
    </div>
    <footer class="footer pt-5 container d-flex justify-content-center">
        <div>
            <p>&copy; 이종헌, 이채현 Robotics Hackathon 2022. All Rights Reserved. </p>
        </div>
    </footer>
    <script>
        function readURL(input) {
            $(".file-upload").css("background", "");
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    $('.image-upload-wrap').hide();
                    $('#loading').show();
                    $('.file-upload-image').attr('src', e.target.result);
                    $('.file-upload-content').show();
                    $('.image-title').html(input.files[0].name);
                };
                reader.readAsDataURL(input.files[0]);
                init().then(function() {
                    console.log("hello");
                    predict();
                    $('#loading').hide();
                });
            } else {
                removeUpload();
            }
        }

        function removeUpload() {
            $('.file-upload-input').replaceWith($('.file-upload-input').clone());
            $('.file-upload-content').hide();
            $('.image-upload-wrap').show();
        }
        $('.image-upload-wrap').bind('dragover', function() {
            $('.image-upload-wrap').addClass('image-dropping');
        });
        $('.image-upload-wrap').bind('dragleave', function() {
            $('.image-upload-wrap').removeClass('image-dropping');
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        let URL;
        const urlMale = "https://teachablemachine.withgoogle.com/models/o9D1N5TN/";
        const urlFemale = "https://teachablemachine.withgoogle.com/models/bB3YHn5r/";
        const urlColor = "https://teachablemachine.withgoogle.com/models/Htl4L1DHM/";
        //Google Teachable Machine Model Link 부분
        let model, webcam, labelContainer, maxPredictions;
        async function init() {
            if (document.getElementById("gender").checked) {
                URL = urlMale;
            } else {
                // URL = urlFemale;
                URL = urlColor;
            }
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";
            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) {
                var element = document.createElement("div")
                element.classList.add("d-flex");
                labelContainer.appendChild(element);
            }
        }
        async function predict() {
            var image = document.getElementById("face-image")
            const prediction = await model.predict(image, false);
            prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
            console.log(prediction)
            console.log(prediction[0].className);
            var resultTitle, resultExplain, resultCeleb;
            var probabilityList = [];
            var zeroList = [];
            for (var i = 0; i < prediction.length; i++ ){
                //CSS tag 네이밍을 위해 영문으로 변환하는 작업
                if (prediction[i].className == 'Spring'){
                    prediction[i].className = 'Spring';
                    prediction[i].order = 0;
                }
                else if (prediction[i].className == 'Summer'){
                    prediction[i].className = 'Summer';
                    prediction[i].order = 1;
                }
                else if (prediction[i].className == 'Fall'){
                    prediction[i].className = 'Fall';
                    prediction[i].order = 2;
                }
                else if (prediction[i].className == 'Winter'){
                    prediction[i].className = 'Winter';
                    prediction[i].order = 3;
                }
                else{
                    prediction[i].className = '알수없음';
                    prediction[i].order = 5;
                }
                // 일단 2자리에서 반올림값이 0이 아니면 앞순위 배치 0이면 후순위
                if (prediction[i].probability.toFixed(2) == 0) {
                    zeroList.push(prediction[i]);
                } else {
                    probabilityList.push(prediction[i]);
                }
            }
            //zeroList를 order 속성을 통해 sort 정렬
            zeroList.sort((a, b) => a.order - b.order);
            probabilityList.push(...zeroList);
            // spred operator(...)을 활용하여 probabilityList뒤에 zeroList의 원소 붙여 넣기
            console.log(probabilityList);
            //토글이 체크 되었을 때, 즉 남자일때
            if (document.getElementById("gender").checked) {
                switch (probabilityList[0].className) {
                    default:
                        resultTitle = "알수없음"
                        resultExplain = ""
                        resultCeleb = ""
                }
            } else {
                switch (probabilityList[0].className) {
                    case "Spring":
                        resultTitle = "당신의 결과는 봄 웜톤 입니다."
                        resultExplain = "봄 웜톤 사람들은 밝고 사랑스러운 이미지를 가지고 있다. 피부톤은 골드, 피치 계열인 편이다."
                        resultCeleb = "봄 웜톤 연예인: 로제, 조이, 수지, 박민영, 이성경"
                        break;
                    case "Summer":
                        resultTitle = "당신의 결과는 여름 쿨톤입니다."
                        resultExplain = "여름 쿨톤 사람들은 청순한 이미지를 가지고 있다. 피부톤은 푸른빛, 보라빛의 베이스를 가지고 있는 편이다."
                        resultCeleb = "여름 쿨톤 연예인: 안소희(원더걸스), 오연서, 한예슬, 이성경, 이효리"
                        break;
                    case "Fall":
                        resultTitle = "당신의 결과는 가을웜톤입니다."
                        resultExplain = "가을 웜톤 사람들은 성숙하고 분위기 있는 이미지를 가지고 있다. 피부톤은 골드, 피치 계열인 편이다."
                        resultCeleb = "가을 웜톤 연예인: 제니, 박신혜, 한효주, 하연수, 이효리, 화사, 김유전, 솔빈"
                        break;
                    case "Winter":
                        resultTitle = "당신의 결과는 겨울 쿨톤입니다."
                        resultExplain = "겨울 쿨톤 사람들은 도회적이면서도 카리스마 있는 이미지를 가지고 있다. 피부톤은 푸른빛, 보라빛의 베이스를 가지고 있는 편이다."
                        resultCeleb = "겨울 쿨톤 연예인: 현아, 브레이브걸스 유나, 손나은, 정은채, 이하늬, 뷔, 지수, 유리"
                        break;        
                    default:
                        resultTitle = "섹시한 밀당고수 여우상"
                        resultExplain = "사람을 홀리는 매력을 가진 당신은 선뜻 다가가기 힘든 섹시한 매력을 가졌다. 우아한 외모에 더해 뛰어난 센스의 성격을 가진 당신은 어딜가도 주목받는 주인공이다! 사교적인 성격을 가져 연인에게도 적극적으로 애정표현을 하지만 밀당의 고수인 당신은 연인의 혼을 쏙 빼놓는 매력쟁이다."
                        resultCeleb = "여우상 연예인: 경리(나인뮤지스), 예지(있지), 한혜진(모델), 헤이즈, 지연(티아라)"
                }
            }
            //grade 값을 가져와 NFT에 저장하기 위해 'meat-grade'라는 id를 부여했다.
            var title = "<div class='" + probabilityList[0].className + "-meat-title' id='meat-grade'>" + resultTitle + "</div>"
            var explain = "<div class='animal-explain pt-2'>" + resultExplain + "</div>"
            var celeb = "<div class='" + probabilityList[0].className + "-meat-celeb pt-2 pb-2'>" + resultCeleb + "</div>"
            $('.result-message').html(title + explain + celeb);
            var barWidth;
            for (let i = 0; i < maxPredictions; i++) {
                if (probabilityList[i].probability.toFixed(2) > 0.1) {
                    barWidth = Math.round(probabilityList[i].probability.toFixed(2) * 100) + "%";
                } else if (probabilityList[i].probability.toFixed(2) >= 0.01) {
                    barWidth = "4%"
                } else {
                    barWidth = "2%"
                }
                var labelTitle;
                switch (probabilityList[i].className) {
                    case "Spring":
                        labelTitle = "봄 웜톤"
                        break;
                    case "Summer":
                        labelTitle = "여름 쿨톤"
                        break;
                    case "Fall":
                        labelTitle = "가을 웜톤"
                        break;
                    case "Winter":
                        labelTitle = "겨울 쿨톤"
                        break;
                    default:
                        labelTitle = "알수없음"
                }
                var label = "<div class='animal-label d-flex align-items-center'>" + labelTitle + "</div>"
                var bar = "<div class='bar-container position-relative container'><div class='" + probabilityList[i].className + "-box'></div><div class='d-flex justify-content-center align-items-center " + probabilityList[i].className + "-bar' style='width: " + barWidth + "'><span class='d-block percent-text'>" + Math.round(probabilityList[i].probability.toFixed(2) * 100) + "%</span></div></div>"
                labelContainer.childNodes[i].innerHTML = label + bar;
            }
        }
        async function test(){
            $('#nft-loading').show();
            const img = $('.file-upload-image').attr('src');
            const grade = $('#meat-grade').text();
            const data = {"grade" : grade,"img": img}
            //https://xiubindev.tistory.com/115 참고 CORS 문제 해결 방법
            //const resp = await axios.post('https://cors-anywhere.herokuapp.com/http://54.180.145.244:58282/', data)
            const resp = await axios.post('https://beef-flask.herokuapp.com/nftMint', data)
            //const resp = await axios.post('http://127.0.0.1:5000//nftMint', data)
            .then(function (response) {
                // NFT 발급시 나타나는 로딩중 요소를 숨긴다. 신기하게 alert 전에 넣어놨지만 소용이 없었다(hide 적용 x) 페이지가 이동하기 전에는 hide가 잘 적용된다
                $('#nft-loading').hide();
                // 단순히 alert(response)만 찍으면 [Object object]형태로만 반환한다. 아래와 같은 형태로 호출해야한다.
                //alert(JSON.stringify(response));
                console.log(response);
                alert("NFT 발행이 완료되었습니다!");
                //klaytn baobab scope 사이트로 이동
                window.location.href = "https://baobab.scope.klaytn.com/tx/" + response["data"]["transactionHash"]+ "?tabId=nftTransfer"
            })
            .catch(function (error) {
                alert(error);
            });
        }
    </script>
    <script>
        function test2(){
            const grade = $('#meat-grade').text();
            console.log(grade);
        }
    </script>
    <script>
        function iosApp() {
            document.getElementById("coupang").style.display="none";
            $("#coupang ins").hide();
            document.getElementById("addThis").style.display="none";
            document.getElementById("disqus_thread").style.display="none";
            var kakao = document.getElementsByClassName("kakao_ad_area");
            for (var i = 0; i < kakao.length; i++) {
              if(kakao[i]) {
                  kakao[i].style.display="none";
              }
            }
            document.getElementById("yotube-top-link").style.display="none";
            document.getElementById("yotube-mid-link").style.display="none";
            document.getElementById("yotube-bottom-link").style.display="none";
        }
    </script>    
</body>
<!-- 
image input box
Copyright (c) 2020 by Aaron Vanston (https://codepen.io/aaronvanston/pen/yNYOXR)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

gender toggle
Copyright (c) 2020 by Mert Cukuren (https://codepen.io/knyttneve/pen/bPpEZY)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 -->
</html>